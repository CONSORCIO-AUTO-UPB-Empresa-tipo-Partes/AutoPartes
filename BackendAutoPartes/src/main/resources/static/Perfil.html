<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Perfil - TOTES BGA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/Perfil.css">
</head>
<body>
<div class="background-stripes">
    <div class="stripe"></div>
    <div class="stripe"></div>
    <div class="stripe"></div>
</div>

<!-- Navbar - Misma estructura que en Catalogo.html para mantener coherencia -->
<nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container">
        <a class="navbar-brand" href="#">
            <img src="../static/img/logo-totes0.png" alt="TOTES BGA" class="logo-principal">
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <form class="d-flex search-form">
                <input class="form-control me-2" type="search" placeholder="Buscar categoría..." aria-label="Search">
                <button class="btn btn-outline-success" type="submit">Buscar</button>
            </form>
            <ul class="navbar-nav ms-auto">
                <li class="nav-item">
                    <a class="nav-link" href="Catalogo.html">Inicio</a>
                </li>

                <!-- Menú desplegable del perfil -->
                <li class="nav-item">
                    <div class="profile-dropdown">
                        <button class="profile-button">
                            <img src="../static/img/USUARIO.png" alt="Perfil" class="profile-icon">
                        </button>
                        <div class="profile-dropdown-content">
                            <a href="Perfil.html">Mi cuenta</a>
                            <a href="Historial_Compras.html">Historial de compras</a>
                            <a href="PrincipalUltimo.html" onclick="logout()">Salir</a>
                        </div>
                    </div>
                </li>

                <!-- Icono del carrito -->
                <li class="nav-item">
                    <a class="nav-link" href="Carrito.html" style="font-size: 27px;">🛒</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<!-- Contenido del perfil -->
<div class="container mt-4">
    <div class="row">
        <div class="col-md-4">
            <div class="profile-sidebar">
                <div class="profile-image">
                    <img src="../static/img/USUARIO.png" alt="Foto de perfil" class="img-fluid rounded-circle">
                </div>
                <h3 id="user-name">Cargando...</h3>
                <p id="user-email">Cargando...</p>
                <div class="profile-menu">
                    <ul class="nav flex-column">
                        <li class="nav-item"><a class="nav-link active" href="#" onclick="showSection('personal-info')">Información Personal</a></li>
                        <li class="nav-item"><a class="nav-link" href="#" onclick="showSection('purchase-history')">Historial de Compras</a></li>
                        <li class="nav-item"><a class="nav-link" href="#" onclick="showSection('security')">Seguridad</a></li>
                        <li class="nav-item"><a class="nav-link" href="#" onclick="showSection('address')">Direcciones</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="col-md-8">
            <!-- Sección de información personal -->
            <div id="personal-info" class="profile-section active">
                <h2>Información Personal</h2>
                <form id="user-info-form">
                    <div class="mb-3">
                        <label for="user-fullname" class="form-label">Nombre completo</label>
                        <input type="text" class="form-control" id="user-fullname" placeholder="Nombre completo">
                    </div>
                    <div class="mb-3">
                        <label for="user-email-input" class="form-label">Correo electrónico</label>
                        <input type="email" class="form-control" id="user-email-input" placeholder="correo@ejemplo.com">
                    </div>
                    <div class="mb-3">
                        <label for="user-phone" class="form-label">Teléfono</label>
                        <input type="tel" class="form-control" id="user-phone" placeholder="123-456-7890">
                    </div>
                    <button type="submit" class="btn btn-primary">Actualizar información</button>
                </form>
            </div>

            <!-- Sección de historial de compras -->
            <div id="purchase-history" class="profile-section">
                <h2>Historial de Compras</h2>
                <div class="purchase-list" id="purchase-list">
                    <p>Cargando historial de compras...</p>
                </div>
            </div>

            <!-- Sección de seguridad -->
            <div id="security" class="profile-section">
                <h2>Seguridad</h2>
                <form id="password-form">
                    <div class="mb-3">
                        <label for="current-password" class="form-label">Contraseña actual</label>
                        <input type="password" class="form-control" id="current-password">
                    </div>
                    <div class="mb-3">
                        <label for="new-password" class="form-label">Nueva contraseña</label>
                        <input type="password" class="form-control" id="new-password">
                    </div>
                    <div class="mb-3">
                        <label for="confirm-password" class="form-label">Confirmar contraseña</label>
                        <input type="password" class="form-control" id="confirm-password">
                    </div>
                    <button type="submit" class="btn btn-primary">Cambiar contraseña</button>
                </form>
            </div>

            <!-- Sección de direcciones -->
            <div id="address" class="profile-section">
                <h2>Mis Direcciones</h2>
                <div id="addresses-list">
                    <p>Cargando direcciones...</p>
                </div>
                <button class="btn btn-primary mt-3" data-bs-toggle="modal" data-bs-target="#addAddressModal">Agregar dirección</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para agregar dirección -->
<div class="modal fade" id="addAddressModal" tabindex="-1" aria-labelledby="addAddressModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addAddressModalLabel">Agregar Nueva Dirección</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="address-form">
                    <div class="mb-3">
                        <label for="address-name" class="form-label">Nombre de la dirección (ej. Casa, Trabajo)</label>
                        <input type="text" class="form-control" id="address-name">
                    </div>
                    <div class="mb-3">
                        <label for="address-street" class="form-label">Dirección</label>
                        <input type="text" class="form-control" id="address-street">
                    </div>
                    <div class="mb-3">
                        <label for="address-city" class="form-label">Ciudad</label>
                        <input type="text" class="form-control" id="address-city">
                    </div>
                    <div class="mb-3">
                        <label for="address-zip" class="form-label">Código Postal</label>
                        <input type="text" class="form-control" id="address-zip">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" onclick="addAddress()">Guardar</button>
            </div>
        </div>
    </div>
</div>

<!-- Footer -->
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-8">
                <ul class="footer-links">
                    <li><a href="#">TotesBGA Financiación</a></li>
                    <li><a href="#">Cookie Settings</a></li>
                    <li><a href="#">Acerca de</a></li>
                    <li><a href="#">Privacidad</a></li>
                    <li><a href="#">Nuestro Sistema</a></li>
                </ul>
                <p class="policy">Política de Protección De Datos Personales</p>
                <p class="copy">&copy; 2025 TotesBGA Colombia. Todos los derechos reservados.</p>
            </div>
        </div>
    </div>
</footer>

<button class="toggle-mode" onclick="toggleMode()">🌓 Modo</button>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- Custom JS -->
<script>
    // Variable para almacenar los datos del usuario
    let userData = null;

    // Al cargar la página, verificamos si hay un token de autenticación
    document.addEventListener('DOMContentLoaded', function() {
        // Obtener token de localStorage
        const token = localStorage.getItem('authToken');

        if (!token) {
            // Si no hay token, redirigir al login
            window.location.href = 'InicioSesionCliente.html';
            return;
        }

        // Cargar datos del usuario
        loadUserData(token);
    });

    // Función para cargar datos del usuario
    function loadUserData(token) {
        // Simulación de datos del usuario (en producción, esto vendría del backend)
        // En una implementación real, aquí harías una llamada fetch al backend
        userData = {
            id: '12345',
            name: 'Carlos Rodriguez',
            email: 'carlos.rodriguez@email.com',
            phone: '321-456-7890',
            addresses: [
                { id: 1, name: 'Casa', street: 'Calle 123 #45-67', city: 'Bucaramanga', zip: '680001' }
            ],
            purchases: [
                { id: 'ORD-001', date: '2023-05-15', total: 82300, status: 'Entregado' },
                { id: 'ORD-002', date: '2023-06-20', total: 150000, status: 'En proceso' }
            ]
        };

        // Actualizar la interfaz con los datos del usuario
        updateUserInterface();
    }

    // Función para actualizar la interfaz con los datos del usuario
    function updateUserInterface() {
        if (!userData) return;

        // Actualizar información básica
        document.getElementById('user-name').textContent = userData.name;
        document.getElementById('user-email').textContent = userData.email;

        // Llenar formulario de información personal
        document.getElementById('user-fullname').value = userData.name;
        document.getElementById('user-email-input').value = userData.email;
        document.getElementById('user-phone').value = userData.phone;

        // Mostrar historial de compras
        updatePurchaseHistory();

        // Mostrar direcciones
        updateAddressesList();
    }

    // Actualizar historial de compras
    function updatePurchaseHistory() {
        const purchaseList = document.getElementById('purchase-list');
        if (userData.purchases.length === 0) {
            purchaseList.innerHTML = '<p>No tienes compras registradas.</p>';
            return;
        }

        let html = '<div class="list-group">';
        userData.purchases.forEach(purchase => {
            html += `
                <div class="list-group-item">
                    <div class="d-flex w-100 justify-content-between">
                        <h5 class="mb-1">Orden #${purchase.id}</h5>
                        <small>${purchase.date}</small>
                    </div>
                    <p class="mb-1">Total: $${purchase.total.toLocaleString()}</p>
                    <small class="text-muted">Estado: ${purchase.status}</small>
                </div>
            `;
        });
        html += '</div>';
        purchaseList.innerHTML = html;
    }

    // Actualizar lista de direcciones
    function updateAddressesList() {
        const addressesList = document.getElementById('addresses-list');
        if (userData.addresses.length === 0) {
            addressesList.innerHTML = '<p>No tienes direcciones registradas.</p>';
            return;
        }

        let html = '<div class="list-group">';
        userData.addresses.forEach(address => {
            html += `
                <div class="list-group-item">
                    <div class="d-flex w-100 justify-content-between">
                        <h5 class="mb-1">${address.name}</h5>
                        <button class="btn btn-sm btn-danger" onclick="removeAddress(${address.id})">Eliminar</button>
                    </div>
                    <p class="mb-1">${address.street}</p>
                    <small class="text-muted">${address.city}, ${address.zip}</small>
                </div>
            `;
        });
        html += '</div>';
        addressesList.innerHTML = html;
    }

    // Función para añadir una dirección
    function addAddress() {
        const name = document.getElementById('address-name').value;
        const street = document.getElementById('address-street').value;
        const city = document.getElementById('address-city').value;
        const zip = document.getElementById('address-zip').value;

        if (!name || !street || !city || !zip) {
            alert('Por favor complete todos los campos de la dirección');
            return;
        }

        // Generar un ID único (en una aplicación real esto vendría del backend)
        const id = userData.addresses.length > 0 ?
            Math.max(...userData.addresses.map(a => a.id)) + 1 : 1;

        // Añadir la dirección a la lista
        userData.addresses.push({ id, name, street, city, zip });

        // Actualizar la UI
        updateAddressesList();

        // Cerrar el modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('addAddressModal'));
        modal.hide();

        // Limpiar el formulario
        document.getElementById('address-form').reset();
    }

    // Función para eliminar una dirección
    function removeAddress(id) {
        if (confirm('¿Está seguro que desea eliminar esta dirección?')) {
            userData.addresses = userData.addresses.filter(address => address.id !== id);
            updateAddressesList();
        }
    }

    // Función para mostrar diferentes secciones del perfil
    function showSection(sectionId) {
        // Ocultar todas las secciones
        document.querySelectorAll('.profile-section').forEach(section => {
            section.classList.remove('active');
        });

        // Mostrar la sección seleccionada
        document.getElementById(sectionId).classList.add('active');

        // Actualizar menú
        document.querySelectorAll('.profile-menu .nav-link').forEach(link => {
            link.classList.remove('active');
        });
        event.target.classList.add('active');
    }

    // Manejar envío del formulario de información personal
    document.getElementById('user-info-form').addEventListener('submit', function(e) {
        e.preventDefault();

        // Actualizar los datos del usuario
        userData.name = document.getElementById('user-fullname').value;
        userData.email = document.getElementById('user-email-input').value;
        userData.phone = document.getElementById('user-phone').value;

        // Actualizar la UI
        updateUserInterface();

        // Mostrar mensaje de éxito
        alert('Información actualizada correctamente');
    });

    // Manejar envío del formulario de cambio de contraseña
    document.getElementById('password-form').addEventListener('submit', function(e) {
        e.preventDefault();

        const currentPassword = document.getElementById('current-password').value;
        const newPassword = document.getElementById('new-password').value;
        const confirmPassword = document.getElementById('confirm-password').value;

        if (!currentPassword || !newPassword || !confirmPassword) {
            alert('Por favor complete todos los campos');
            return;
        }

        if (newPassword !== confirmPassword) {
            alert('Las contraseñas no coinciden');
            return;
        }

        // En una aplicación real, aquí se enviaría la solicitud al backend

        // Mostrar mensaje de éxito
        alert('Contraseña actualizada correctamente');

        // Resetear el formulario
        this.reset();
    });

    // Función para cerrar sesión
    function logout() {
        // Eliminar token de autenticación
        localStorage.removeItem('authToken');
        // Redireccionar a la página principal
        window.location.href = 'PrincipalUltimo.html';
    }

    // Función para cambiar el modo claro/oscuro
    function toggleMode() {
        document.body.classList.toggle("modo-claro");

        // Guardar preferencia en localStorage
        if (document.body.classList.contains("modo-claro")) {
            localStorage.setItem("modo", "claro");
        } else {
            localStorage.setItem("modo", "oscuro");
        }
    }

    // Aplicar el modo guardado al cargar la página
    (function aplicarModoGuardado() {
        const modoGuardado = localStorage.getItem("modo");
        if (modoGuardado === "claro") {
            document.body.classList.add("modo-claro");
        }
    })();
</script>
</body>
</html>